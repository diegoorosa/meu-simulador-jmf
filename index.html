<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Abertura de Empresa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-2xl">
        <div class="w-full bg-white p-6 sm:p-8 rounded-xl shadow-lg">
            <div class="text-center mb-6">
                <!-- A logo será carregada a partir da pasta 'public' -->
                <img src="/JMF-Logo-Open-Graph.png" alt="Logo JMF Contabilidade" class="mx-auto h-28 mb-4">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Simulador para Abertura de Empresa</h1>
                <p class="text-gray-600 text-sm sm:text-base mt-2">Preencha os dados abaixo para receber uma análise tributária e nossa proposta.</p>
            </div>
        
            <form id="simulador-form" class="space-y-4">
                <!-- Seus campos de formulário continuam aqui... -->
                 <h2 class="text-lg font-semibold pb-2 border-b border-gray-200 mb-4 text-gray-700">Seus Dados de Contato</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="nome" class="block text-sm font-medium text-gray-700">Seu nome</label>
                        <input type="text" id="nome" name="nome" placeholder="Ex: João da Silva" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </div>
                    <div>
                        <label for="whatsapp" class="block text-sm font-medium text-gray-700">WhatsApp</label>
                        <input type="tel" id="whatsapp" name="whatsapp" placeholder="(47) 99999-8888" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </div>
                </div>
                 <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Seu melhor email</label>
                    <input type="email" id="email" name="email" placeholder="Ex: joao.silva@email.com" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                </div>
        
                <h2 class="text-lg font-semibold pt-4 pb-2 border-b border-gray-200 mb-4 text-gray-700">Dados da Futura Empresa</h2>
                <div>
                    <label for="cidade" class="block text-sm font-medium text-gray-700">Cidade onde a empresa será sediada</label>
                    <input type="text" id="cidade" name="cidade" placeholder="Ex: Blumenau - SC" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                </div>
                <div>
                    <label for="atividade" class="block text-sm font-medium text-gray-700">Atividade principal</label>
                    <input type="text" id="atividade" name="atividade" placeholder="Ex: Desenvolvimento de software" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="socios" class="block text-sm font-medium text-gray-700">Sócios</label>
                        <input type="number" id="socios" name="socios" value="1" min="1" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </div>
                    <div>
                        <label for="funcionarios" class="block text-sm font-medium text-gray-700">Funcionários</label>
                        <input type="number" id="funcionarios" name="funcionarios" value="0" min="0" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </div>
                     <div>
                        <label for="faturamento" class="block text-sm font-medium text-gray-700">Fat. Mensal (R$)</label>
                        <input type="number" id="faturamento" name="faturamento" placeholder="Opcional" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </div>
                </div>
                
                <div class="pt-4">
                    <button type="submit" id="analisar-btn" class="w-full flex justify-center py-2.5 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <span id="btn-text">Gerar Análise e Solicitar Proposta</span>
                        <div id="loading" class="hidden w-5 h-5 border-t-2 border-white border-solid rounded-full animate-spin"></div>
                    </button>
                </div>
            </form>
            
            <div id="resultado-container" class="mt-6 hidden">
                <div class="mt-6 p-4 bg-green-100 text-green-900 border-l-4 border-green-500 rounded-r-lg">
                    <h3 class="font-bold">Proposta a Caminho!</h3>
                    <p class="mt-2 text-sm">Agradecemos o seu interesse! Nossa equipe já recebeu seus dados e está preparando sua proposta personalizada. <br><br><strong>Você receberá tudo detalhado diretamente no WhatsApp informado dentro de algumas horas.</strong></p>
                </div>
                
                <details class="mt-4" open>
                    <summary class="cursor-pointer text-sm text-blue-600 hover:underline">Ver análise tributária preliminar</summary>
                    <div id="resultado-analise" class="mt-2 p-4 border rounded-md text-gray-700 leading-relaxed text-sm bg-gray-50" style="white-space: pre-wrap;"></div>
                    
                    <p class="mt-3 text-xs text-gray-500 italic">
                        *Aviso Legal: Esta é uma análise preliminar gerada por Inteligência Artificial e não substitui a consultoria de um profissional de contabilidade.
                    </p>
                </details>
            </div>
        </div>
    </main>

    <script type="module">
        const form = document.getElementById('simulador-form');
        const analisarBtn = document.getElementById('analisar-btn');
        const btnText = document.getElementById('btn-text');
        const loadingIndicator = document.getElementById('loading');
        const resultadoContainer = document.getElementById('resultado-container');
        const resultadoAnalise = document.getElementById('resultado-analise');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            toggleLoading(true);

            const formData = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                whatsapp: document.getElementById('whatsapp').value,
                cidade: document.getElementById('cidade').value,
                atividade: document.getElementById('atividade').value,
                socios: document.getElementById('socios').value,
                funcionarios: document.getElementById('funcionarios').value,
                faturamentoMensal: document.getElementById('faturamento').value || '0',
            };

            try {
                const response = await fetch('/api/generate-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'Erro desconhecido do servidor.');
                }

                const htmlAnalise = marked.parse(result.analise); // Converte o texto para HTML
                resultadoAnalise.innerHTML = htmlAnalise;         // Exibe o resultado formatado

            } catch (error) {
                console.error('Erro no processo:', error);
                resultadoAnalise.textContent = 'Desculpe, não foi possível processar a análise no momento. Nossa equipe recebeu seus dados e entrará em contato de qualquer forma.';
            } finally {
                resultadoContainer.classList.remove('hidden');
                toggleLoading(false);
                form.style.display = 'none';
            }
        });

        function toggleLoading(isLoading) {
            if (isLoading) {
                btnText.style.display = 'none';
                loadingIndicator.classList.remove('hidden');
                analisarBtn.disabled = true;
            } else {
                btnText.style.display = 'inline';
                loadingIndicator.classList.add('hidden');
                analisarBtn.disabled = false;
            }
        }
    </script>
</body>
</html>
